# deploy_admin_terminal.yml
---
- hosts: admin_terminal
  sudo: yes
  roles:
    - iptables
    - {role: common, when: "install_glusterfs"}
    - {role: python, when: "custom_repo"}
    - {role: python-build, when: "not custom_repo"}
    - eod

  tasks:
    - name: Install Ansible in Python 2.7
      pip:
        virtualenv_command: /usr/local/bin/virtualenv
        virtualenv: ~/.virtualenvs/data-platform
        name: ansible
        state: present
      sudo: no
    - name: Allow SSH access from internal subnet
      command: "iptables -I {{ iptables_chain }} 3 -m state --state NEW -p tcp -m tcp --dport 22 -s {{ subnet }} -j ACCEPT"
      sudo: yes
    - name: Save IP tables
      command: "/sbin/service iptables save"
      sudo: yes
